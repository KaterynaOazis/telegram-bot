from datetime import datetime, time
from telegram import Update
from telegram.ext import ApplicationBuilder, MessageHandler, ContextTypes, filters
from langdetect import detect

# –†–æ–±–æ—á–∏–π —á–∞—Å
WORK_START = time(18, 0)
WORK_END = time(9, 0)

# –í—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø–æ–∑–∞ —Ä–æ–±–æ—á–∏–º —á–∞—Å–æ–º
RESPONSES = {
    'pl': "Nasi mened≈ºerowie odpowiedzƒÖ na Twoje pytanie w godzinach pracy.\n"
          "09:00 - 18:00 ‚Äì w tych godzinach nasz zesp√≥≈Ç jest zawsze dostƒôpny.",

    'ru': "–ù–∞—à–∏ –º–µ–Ω–µ–¥–∂–µ—Ä—ã –æ—Ç–≤–µ—Ç—è—Ç –≤–∞–º –≤ —Ä–∞–±–æ—á–∏–µ —á–∞—Å—ã.\n"
          "09:00 ‚Äì 18:00 ‚Äì –≤ —ç—Ç–æ –≤—Ä–µ–º—è –∫–æ–º–∞–Ω–¥–∞ –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏.",

    'uk': "–ù–∞—à—ñ –º–µ–Ω–µ–¥–∂–µ—Ä–∏ –¥–∞–¥—É—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—å —É —Ä–æ–±–æ—á–∏–π —á–∞—Å.\n"
          "09:00 ‚Äì 18:00 ‚Äì —Å–∞–º–µ —Ç–æ–¥—ñ –∫–æ–º–∞–Ω–¥–∞ –Ω–∞ –∑–≤'—è–∑–∫—É.",

    'en': "Our managers will get back to you during business hours.\n"
          "09:00 ‚Äì 18:00 ‚Äì during this time, our team is always available.",

    'default': "We will respond during our business hours: 09:00 ‚Äì 18:00."
}

# –í—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ –∞–≤–∞—Ä—ñ–π–Ω—ñ —Å–∏—Ç—É–∞—Ü—ñ—ó
ACCIDENT_RESPONSES = {
    'uk': "–ó—ñ–±—Ä–∞–ª–∏ –¥–ª—è –≤–∞—Å —Å–ø–∏—Å–æ–∫ —Ü—ñ–ª–æ–¥–æ–±–æ–≤–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤ –¥–ª—è –¥–æ–ø–æ–º–æ–≥–∏ –≤ –Ω—ñ—á–Ω–∏–π —á–∞—Å, –∞ —Å–∞–º–µ:\n\n"
          "1. –¶—ñ–ª–æ–¥–æ–±–æ–≤–∏–π –∞–≤—Ç–æ–º–∞–≥–∞–∑–∏–Ω (–º–æ–∂–Ω–∞ –∫—É–ø–∏—Ç–∏ –±—É–¥—å-—è–∫—É –ª–∞–º–ø–æ—á–∫—É —á–∏ –±–∞—Ç–∞—Ä–µ–π–∫—É):\n"
          "üìçhttps://maps.app.goo.gl/kAJTVjhWVwqp8R9S8\n\n"
          "2. –¶—ñ–ª–æ–¥–æ–±–æ–≤—ñ —à–∏–Ω–æ–º–æ–Ω—Ç–∞–∂—ñ –≤ —Ä—ñ–∑–Ω–∏—Ö —Ä–∞–π–æ–Ω–∞—Ö –í–∞—Ä—à–∞–≤–∏:\n"
          "üìçhttps://maps.app.goo.gl/ihAP8Mq6JrbfcPNY9?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/jHscEECMq7oaYX4X6?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/c1Lxhvf65d61Kzru6?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/2nzUok591ymrHutW6?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/qRJkA8amP18A6W5p6?g_st=it\n\n"
          "3. –ú–æ–±—ñ–ª—å–Ω–∏–π —à–∏–Ω–æ–º–æ–Ω—Ç–∞–∂ (—è–∫—â–æ –ø—Ä–æ–±–∏–ª–∏ –∫–æ–ª–µ—Å–æ –π –Ω–µ –º–æ–∂–µ—Ç–µ –¥—ñ—Å—Ç–∞—Ç–∏—Å—è –¥–æ —Å—Ç–∞–Ω—Ü—ñ—ó —Å–∞–º–æ—Å—Ç—ñ–π–Ω–æ):\n"
          "üìçhttps://maps.app.goo.gl/iaG17MJkGnd4RzQB9?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/g31X768Dj3a3SR616?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/qk9pWTVJ9fZa4ALq6?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/qRJkA8amP18A6W5p6?g_st=it\n\n"
          "4. –ï–≤–∞–∫—É–∞—Ç–æ—Ä:\nüìû +48 791 323 496 ‚Äî –ö–∞–Ω–∞—Ç\n\n"
          "üìÉ –¶—ñ –ø–æ—Å–ª—É–≥–∏ –≤–∏ –æ–ø–ª–∞—á—É—î—Ç–µ —Å–∞–º–æ—Å—Ç—ñ–π–Ω–æ, –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ –Ω–∞ —Ñ—ñ—Ä–º–æ–≤—É —Ñ–∞–∫—Ç—É—Ä—É:\n"
          "‚ÄºÔ∏è NIP: 5213954140 ‚ÄºÔ∏è\nOAZIS PARK SP. Z O.O.\n01-242, Warszawa, Aleja Prymasa TysiƒÖclecia 81a\n\n"
          "‚ÄºÔ∏è –ö–æ–º–ø–µ–Ω—Å–∞—Ü—ñ—è –∑–∞ —à–∏–Ω–æ–º–æ–Ω—Ç–∞–∂ ‚Äî —Ç—ñ–ª—å–∫–∏ –∑–∞ —Ä–µ–º–æ–Ω—Ç —à–∏–Ω–∏ (—è–∫—â–æ —à–∏–Ω—É –Ω–µ –º–æ–∂–Ω–∞ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ ‚Äî –ø–ª–∞—Ç–∏—Ç—å –≤–æ–¥—ñ–π).\n"
          "–¢–∞–∫–æ–∂ –≤—ñ–¥—à–∫–æ–¥—É–≤–∞–Ω–Ω—è –∑–∞ –µ–≤–∞–∫—É–∞—Ç–æ—Ä –º–æ–∂–ª–∏–≤–µ –ª–∏—à–µ —É –≤–∏–ø–∞–¥–∫—É, —è–∫—â–æ –ø–æ–ª–æ–º–∫–∞ —Å—Ç–∞–ª–∞—Å—è –Ω–µ –∑ –≤–∏–Ω–∏ –≤–æ–¥—ñ—è.\n"
          "–ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∫–æ—à—Ç—ñ–≤ –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è –ø—ñ–¥ —á–∞—Å –Ω–∞–π–±–ª–∏–∂—á–æ–≥–æ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —ñ –ª–∏—à–µ –∑–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ —Ñ–∞–∫—Ç—É—Ä–∏ (–ø–æ—Ç—Ä—ñ–±–Ω–æ –Ω–∞–¥–∞—Ç–∏ –≤ –æ—Ñ—ñ—Å). ‚ÄºÔ∏è",

    'ru': "–°–æ–±—Ä–∞–ª–∏ –¥–ª—è –≤–∞—Å —Å–ø–∏—Å–æ–∫ –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –¥–ª—è –ø–æ–º–æ—â–∏ –≤ –Ω–æ—á–Ω–æ–µ –≤—Ä–µ–º—è, –∞ –∏–º–µ–Ω–Ω–æ:\n\n"
          "1. –ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞–≥–∞–∑–∏–Ω (–∫—É–ø–∏—Ç—å –ª—é–±—É—é –ª–∞–º–ø–æ—á–∫—É –∏–ª–∏ –±–∞—Ç–∞—Ä–µ–π–∫—É):\nüìçhttps://maps.app.goo.gl/kAJTVjhWVwqp8R9S8\n\n"
          "2. –ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω—ã–π —à–∏–Ω–æ–º–æ–Ω—Ç–∞–∂ –≤ —Ä–∞–∑–Ω—ã—Ö —Ä–∞–π–æ–Ω–∞—Ö –í–∞—Ä—à–∞–≤—ã:\nüìçhttps://maps.app.goo.gl/ihAP8Mq6JrbfcPNY9?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/jHscEECMq7oaYX4X6?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/c1Lxhvf65d61Kzru6?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/2nzUok591ymrHutW6?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/qRJkA8amP18A6W5p6?g_st=it\n\n"
          "3. –ú–æ–±–∏–ª—å–Ω—ã–π —à–∏–Ω–æ–º–æ–Ω—Ç–∞–∂ (–µ—Å–ª–∏ –ø—Ä–æ–±–∏–ª–∏ –∫–æ–ª–µ—Å–æ –∏ –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ–µ—Ö–∞—Ç—å –¥–æ —Å—Ç–∞–Ω—Ü–∏–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ):\n"
          "üìçhttps://maps.app.goo.gl/iaG17MJkGnd4RzQB9?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/g31X768Dj3a3SR616?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/qk9pWTVJ9fZa4ALq6?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/qRJkA8amP18A6W5p6?g_st=it\n\n"
          "4. –≠–≤–∞–∫—É–∞—Ç–æ—Ä:\nüìû+48 791 323 496 –ö–∞–Ω–∞—Ç (Kanat)\n\n"
          "üìÉ–î–∞–Ω–Ω—ã–µ —É—Å–ª—É–≥–∏ –≤—ã –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞ —Ñ–∞–∫—Ç—É—Ä—É —Ñ–∏—Ä–º—ã:\n"
          "‚ÄºÔ∏èNIP: 5213954140‚ÄºÔ∏è\nOAZIS PARK SP. Z O.O.\n01-242, Warszawa, Aleja Prymasa TysiƒÖclecia 81a\n\n"
          "‚ÄºÔ∏è–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è —Å—Ä–µ–¥—Å—Ç–≤ –∑–∞ —à–∏–Ω–æ–º–æ–Ω—Ç–∞–∂ —Ç–æ–ª—å–∫–æ –∑–∞ —Ä–µ–º–æ–Ω—Ç –∫–æ–ª–µ—Å–∞ (–µ—Å–ª–∏ —à–∏–Ω—É –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å, –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç –≤–æ–¥–∏—Ç–µ–ª—å).\n"
          "–ê —Ç–∞–∫–∂–µ –∫–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è —Å—Ä–µ–¥—Å—Ç–≤ –∑–∞ —ç–≤–∞–∫—É–∞—Ç–æ—Ä –≤ —Ç–æ–º —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ –≤ –ø–æ–ª–æ–º–∫–µ –Ω–µ—Ç –≤–∏–Ω—ã –≤–æ–¥–∏—Ç–µ–ª—è.\n"
          "–í–æ–∑–≤—Ä–∞—Ç –ø–æ–ª—É—á–∏—Ç–µ –ø—Ä–∏ –±–ª–∏–∂–∞–π—à–µ–º —Ä–∞—Å—á–µ—Ç–µ –∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ñ–∞–∫—Ç—É—Ä—ã (–Ω—É–∂–Ω–æ –ø—Ä–∏–Ω–µ—Å—Ç–∏ –≤ –æ—Ñ–∏—Å)‚ÄºÔ∏è",

    'pl': "Przygotowali≈õmy dla Ciebie listƒô ca≈Çodobowych us≈Çug, kt√≥re pomogƒÖ Ci w nocy, a mianowicie:\n\n"
          "1. 24-godzinny  sklep motoryzacyjny (mo≈ºliwo≈õƒá zakupu dowolnej ≈ºar√≥wki lub baterii):\nüìçhttps://maps.app.goo.gl/kAJTVjhWVwqp8R9S8\n\n"
          "2. 24-godzinny monta≈º opon w r√≥≈ºnych rejonach Warszawy:\nüìçhttps://maps.app.goo.gl/ihAP8Mq6JrbfcPNY9?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/jHscEECMq7oaYX4X6?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/c1Lxhvf65d61Kzru6?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/2nzUok591ymrHutW6?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/qRJkA8amP18A6W5p6?g_st=it\n\n"
          "3. Mobilny monta≈º opon (je≈õli z≈Çapa≈Çe≈õ gumƒô i nie masz mo≈ºliwo≈õci samodzielnego dojazdu na stacjƒô):\n"
          "üìçhttps://maps.app.goo.gl/iaG17MJkGnd4RzQB9?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/g31X768Dj3a3SR616?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/qk9pWTVJ9fZa4ALq6?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/qRJkA8amP18A6W5p6?g_st=it\n\n"
          "4. Laweta:\nüìû+48 791 323 496 Kanat\n\n"
          "üìÉZa te us≈Çugi p≈Çacisz samodzielnie, koniecznie na firmowej fakturze:\n"
          "‚ÄºÔ∏èNIP: 5213954140‚ÄºÔ∏è\nOAZIS PARK SP. Z O.O.\n01-242, Warszawa, Aleja Prymasa TysiƒÖclecia 81a\n\n"
          "‚ÄºÔ∏èRekompensata koszt√≥w za monta≈º opon jest przyznawana tylko za naprawƒô ko≈Ça (je≈õli opona nie nadaje siƒô do naprawy, koszty ponosi kierowca).\n"
          "Ponadto, rekompensata koszt√≥w za holowanie jest przyznawana w przypadku, gdy awaria nie jest z winy kierowcy.\n"
          "Zwrot otrzymasz przy najbli≈ºszym rozliczeniu, i tylko po okazaniu faktury (nale≈ºy dostarczyƒá do biura).‚ÄºÔ∏è",

    'en': "We have compiled a list of 24-hour services for assistance at night, namely:\n\n"
          "1. 24/7 auto store (purchase any bulb or battery):\nüìçhttps://maps.app.goo.gl/kAJTVjhWVwqp8R9S8\n\n"
          "2. 24-hour tire service in different areas Warsaw:\nüìçhttps://maps.app.goo.gl/ihAP8Mq6JrbfcPNY9?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/jHscEECMq7oaYX4X6?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/c1Lxhvf65d61Kzru6?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/2nzUok591ymrHutW6?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/qRJkA8amP18A6W5p6?g_st=it\n\n"
          "3. Mobile tire service (if you have a flat tire and can't get to the station by yourself):\n"
          "üìçhttps://maps.app.goo.gl/iaG17MJkGnd4RzQB9?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/g31X768Dj3a3SR616?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/qk9pWTVJ9fZa4ALq6?g_st=it\n"
          "üìçhttps://maps.app.goo.gl/qRJkA8amP18A6W5p6?g_st=it\n\n"
          "4. Tow truck:\nüìû+48 791 323 496 Kanat\n\n"
          "üìÉYou pay for these services yourself, be sure to get invoice of the company:\n"
          "‚ÄºÔ∏èNIP: 5213954140‚ÄºÔ∏è\nOAZIS PARK SP. Z O.O.\n01-242, Warszawa, Aleja Prymasa TysiƒÖclecia 81a\n\n"
          "‚ÄºÔ∏èCompensation for tire fitting costs is provided only for wheel repair (if the tire cannot be repaired, the driver covers the costs).\n"
          "Additionally, compensation for towing is provided if the breakdown is not the driver's fault.\n"
          "The refund will be issued during the next settlement, and only upon presenting an invoice (it must be brought to the office).‚ÄºÔ∏è"
}

# –û–±—Ä–æ–±–Ω–∏–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    now = datetime.now().time()
    user_text = update.message.text.lower()
    print("‚úâÔ∏è –û—Ç—Ä–∏–º–∞–Ω–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:", user_text)
    print("üóï –ü–æ—Ç–æ—á–Ω–∏–π —á–∞—Å:", now)

    # –í–∏–∑–Ω–∞—á–∞—î–º–æ –º–æ–≤—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    try:
        lang = detect(user_text)
        print("üåê –í–∏–∑–Ω–∞—á–µ–Ω–∞ –º–æ–≤–∞:", lang)
    except:
        lang = 'default'

    # üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –∞–≤–∞—Ä—ñ–π–Ω—ñ —Ç—Ä–∏–≥–µ—Ä–∏
    accident_keywords = [
        # Ukrainian
        "–ø—Ä–æ–±–∏–≤ —à–∏–Ω—É", "–∫–æ–ª–µ—Å–æ", "–Ω–µ —ó–¥–µ –∞–≤—Ç–æ", "–∞–≤–∞—Ä—ñ—è", "–¥—Ç–ø", "–∞–≤–∞—Ä—ñ–π–Ω–∞ —Å–∏—Ç—É–∞—Ü—ñ—è", "–ø–æ–º–∏–ª–∫–∞", "—á–µ–∫ –≥—ñ–±—Ä–∏–¥", "–ª–∞–º–ø–æ—á–∫–∞", "–ª–∞–º–ø–∞",
        # Russian
        "–ø—Ä–æ–±–∏–ª —à–∏–Ω—É", "–º–∞—à–∏–Ω–∞ –Ω–µ –µ–¥–µ—Ç", "–∞–≤–∞—Ä–∏—è", "–¥—Ç–ø", "–∞–≤–∞—Ä–∏–π–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è", "–æ—à–∏–±–∫–∞", "–∑–∞–≥–æ—Ä–µ–ª—Å—è —á–µ–∫ –≥–∏–±—Ä–∏–¥", "–ª–∞–º–ø–æ—á–∫–∞", "–ª–∞–º–ø–∞",
        # Polish
        "przebi≈Çem oponƒô", "ko≈Ço", "z≈Çapa≈Çem gumƒô", "samoch√≥d nie jedzie", "nie rusza", "wypadek", "kolizja", "sytuacja awaryjna",
        "b≈ÇƒÖd", "kontrolka", "check hybrid", "≈ºar√≥wka", "lampa",
        # English
        "flat tire", "punctured a tire", "car won‚Äôt move", "car is not driving", "accident", "car crash", "emergency situation",
        "error", "check hybrid system", "hybrid warning", "bulb", "lamp"
    ]

    if any(trigger in user_text for trigger in accident_keywords):
        response = ACCIDENT_RESPONSES.get(lang, ACCIDENT_RESPONSES['en'])
        await update.message.reply_text(response)
        return

    # –í—ñ–¥–ø–æ–≤—ñ–¥—å –ø–æ–∑–∞ —Ä–æ–±–æ—á–∏–º —á–∞—Å–æ–º
    if not (WORK_START <= now <= WORK_END):
        response = RESPONSES.get(lang, RESPONSES['default'])
        await update.message.reply_text(response)

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –±–µ–∑ asyncio.run()
app = ApplicationBuilder().token("7190316034:AAE5ZRYRX2_QNzoqu4exnvvecksoh2mCplg").build()
app.add_handler(MessageHandler(filters.ChatType.GROUPS & filters.TEXT, handle_message))
print("‚úÖ –ë–æ—Ç –ø—Ä–∞—Ü—é—î. –û—á—ñ–∫—É—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —É –≥—Ä—É–ø–∞—Ö...")
app.run_polling()